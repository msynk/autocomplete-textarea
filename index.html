<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Textarea Ghost Suggestion at Cursor</title>
    <style>
        .autocomplete-wrapper {
            display: flex;
            position: relative;
            width: fit-content;
            height: fit-content;
        }

        .overlay,
        .textarea {
            width: 100%;
            padding: 8px;
            height: 150px;
            font-size: 16px;
            line-height: 1.4;
            word-wrap: break-word;
            white-space: pre-wrap;
            box-sizing: border-box;
            font-family: monospace;
        }

        .overlay {
            top: 0;
            left: 0;
            z-index: 0;
            width: 100%;
            height: 100%;
            color: #aaa;
            overflow: auto;
            position: absolute;
            pointer-events: none;
        }

        .textarea {
            z-index: 1;
            border: none;
            position: relative;
            outline: 1px solid;
            background: transparent;
        }
    </style>
</head>

<body>
    <div class="autocomplete-wrapper">
        <div class="overlay"></div>
        <textarea class="textarea" placeholder="Type something..." autofocus></textarea>
    </div>

    <script>
        const suggestions = [
            "application form",
            "banana smoothie",
            "car repair manual",
            "dog training guide"
        ];

        const textarea = document.querySelector(".textarea");
        const overlay = document.querySelector(".overlay");
        let _ghostText = "";
        function updateOverlay() {
            const value = textarea.value;
            if (!value) {
                overlay.innerHTML = "";
                return;
            }

            const lastWord = value.split(/\s+/).pop();
            if (!lastWord) {
                overlay.innerHTML = value;
                return;
            }

            const match = suggestions.find(item => item.toLowerCase().startsWith(lastWord.toLowerCase()));

            _ghostText = match ? match.slice(lastWord.length) : "";

            overlay.innerHTML = value + escapeHtml(_ghostText);
        }

        function escapeHtml(text) {
            return text.replace(/[&<>"']/g, c => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;", "'": "&#39;" }[c]));
        }

        textarea.addEventListener("input", updateOverlay);
        textarea.addEventListener("keyup", updateOverlay);
        textarea.addEventListener("click", updateOverlay);

        textarea.addEventListener("scroll", (e) => {
            overlay.scrollTop = textarea.scrollTop;
            overlay.scrollLeft = textarea.scrollLeft;
        })

        textarea.addEventListener("keydown", (e) => {
            if (e.key === "Tab") {
                const value = textarea.value;
                if (!value) return;

                if (_ghostText) {
                    e.preventDefault();
                    textarea.value = textarea.value + _ghostText;
                    updateOverlay();
                    textarea.scrollTop = textarea.scrollHeight;
                }
            }
        });

        updateOverlay();
    </script>
</body>

</html>